(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{225:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){"use strict";n.r(t);var r=n(83),a=n.n(r),o=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,267)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),o(e),c(e)}))},c=n(4),s=n(0),i=n(45),u=n(21),l=(n(225),n(256)),j=n(19),b=n(28),d=n(203),m={user:null};if(localStorage.getItem("jwtToken")){var O=Object(d.a)(localStorage.getItem("jwtToken"));1e3*O.exp<Date.now()?localStorage.removeItem("jwtToken"):m.user=O}var p=Object(s.createContext)({user:null,login:function(e){},logout:function(){}});function h(e,t){switch(t.type){case"LOGIN":return Object(b.a)(Object(b.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(b.a)(Object(b.a)({},e),{},{user:null});default:return e}}function x(e){var t=Object(s.useReducer)(h,m),n=Object(j.a)(t,2),r=n[0],a=n[1];return Object(c.jsx)(p.Provider,Object(b.a)({value:{user:r.user,login:function(e){localStorage.setItem("jwtToken",e.token),a({type:"LOGIN",payload:e})},logout:function(){a({type:"LOGOUT"}),localStorage.removeItem("jwtToken")}}},e))}var g=n(211);var f=function(e){var t=e.component,n=Object(g.a)(e,["component"]),r=Object(s.useContext)(p).user;return Object(c.jsx)(u.b,Object(b.a)(Object(b.a)({},n),{},{render:function(e){return r?Object(c.jsx)(u.a,{to:"/"}):Object(c.jsx)(t,Object(b.a)({},e))}}))},v=(n(230),n(259));var y=function(){var e=Object(s.useContext)(p),t=e.user,n=e.logout,r=window.location.pathname,a="/"===r?"home":r.substr(1),o=Object(s.useState)(a),u=Object(j.a)(o,2),l=u[0],b=u[1],d=function(e,t){var n=t.name;return b(n)};return t?Object(c.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(c.jsx)(v.a.Item,{name:t.username,active:!0,as:i.b,to:"/"}),Object(c.jsx)(v.a.Menu,{position:"right",children:Object(c.jsx)(v.a.Item,{name:"logout",onClick:n})})]}):Object(c.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(c.jsx)(v.a.Item,{name:"home",active:"home"===l,onClick:d,as:i.b,to:"/"}),Object(c.jsxs)(v.a.Menu,{position:"right",children:[Object(c.jsx)(v.a.Item,{name:"login",active:"login"===l,onClick:d,as:i.b,to:"/login"}),Object(c.jsx)(v.a.Item,{name:"register",active:"register"===l,onClick:d,as:i.b,to:"/register"})]})]})},C=n(266),w=n(260),I=n(15),k=n(262),S=n(209),P=n(257),$=n(263),N=n(114),A=n(160),L=n(121),D=n.n(L),q=n(33);function M(){var e=Object(q.a)(["\n    mutation likePost($postId: ID!){\n        likePost(postId: $postId){\n            id\n            likes{\n                id username\n            }\n            likeCount\n        }\n    }\n"]);return M=function(){return e},e}var E=Object(I.gql)(M()),R=function(e){var t=e.user,n=e.post,r=n.id,a=n.likeCount,o=n.likes,u=Object(s.useState)(!1),l=Object(j.a)(u,2),b=l[0],d=l[1];Object(s.useEffect)((function(){t&&o.find((function(e){return e.username===t.username}))?d(!0):d(!1)}),[t,o]);var m=Object(I.useMutation)(E,{variables:{postId:r},onError:function(e){console.log(e)}}),O=Object(j.a)(m,1)[0],p=t?b?Object(c.jsx)($.a,{color:"red",children:Object(c.jsx)(N.a,{name:"heart"})}):Object(c.jsx)($.a,{color:"red",basic:!0,children:Object(c.jsx)(N.a,{name:"heart"})}):Object(c.jsx)($.a,{as:i.b,to:"/login",color:"red",basic:!0,children:Object(c.jsx)(N.a,{name:"heart"})});return Object(c.jsxs)($.a,{as:"div",labelPosition:"right",onClick:O,children:[p,Object(c.jsx)(A.a,{as:"a",basic:!0,color:"red",pointing:"left",children:a})]})},T=n(261);function Q(){var e=Object(q.a)(["\n    {\n        getPosts{\n        id \n        body \n        createdAt \n        username \n        likeCount \n        likes{\n            username\n        }\n        commentCount\n        comments{id username createdAt body}\n    }\n    }\n"]);return Q=function(){return e},e}var F=Object(I.gql)(Q());function z(){var e=Object(q.a)(["\n    mutation deleteComment($postId: ID!, $commentId: ID!){\n        deleteComment(postId: $postId, commentId: $commentId){\n            id\n            comments{\n                id username createdAt body\n            }\n            commentCount\n        }\n    }\n"]);return z=function(){return e},e}function B(){var e=Object(q.a)(["\n    mutation deletePost($postId: ID!){\n        deletePost(postId: $postId)\n    }\n"]);return B=function(){return e},e}var G=Object(I.gql)(B()),H=Object(I.gql)(z()),J=function(e){var t=e.postId,n=e.commentId,r=e.callback,a=Object(s.useState)(!1),o=Object(j.a)(a,2),i=o[0],u=o[1],l=n?H:G,d=Object(I.useMutation)(l,{update:function(e){if(u(!1),!n){var a=e.readQuery({query:F}),o=a.getPosts.filter((function(e){return e.id!==t}));e.writeQuery({query:F,data:Object(b.a)(Object(b.a)({},a),{},{getPosts:{newData:o}})})}r&&r()},variables:{postId:t,commentId:n}}),m=Object(j.a)(d,1)[0];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(P.a,{content:n?"Delete comment":"Delete post",inverted:!0,trigger:Object(c.jsx)($.a,{as:"div",color:"red",onClick:function(){return u(!0)},children:Object(c.jsx)(N.a,{name:"trash",style:{margin:0}})})}),Object(c.jsx)(T.a,{open:i,onCancel:function(){return u(!1)},onConfirm:m})]})};var U=function(e){var t=e.post,n=t.body,r=t.createdAt,a=t.id,o=t.username,u=t.likeCount,l=t.commentCount,j=t.likes,b=Object(s.useContext)(p).user;return Object(c.jsxs)(k.a,{fluid:!0,children:[Object(c.jsxs)(k.a.Content,{children:[Object(c.jsx)(S.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(c.jsx)(k.a.Header,{children:o}),Object(c.jsx)(k.a.Meta,{as:i.b,to:"/posts/".concat(a),children:D()(r).fromNow(!0)}),Object(c.jsx)(k.a.Description,{children:n})]}),Object(c.jsxs)(k.a.Content,{extra:!0,children:[Object(c.jsx)(R,{user:b,post:{id:a,likes:j,likeCount:u}}),Object(c.jsx)(P.a,{content:"Comment on post",inverted:!0,trigger:Object(c.jsxs)($.a,{labelPosition:"right",as:i.b,to:"/posts/".concat(a),children:[Object(c.jsxs)($.a,{color:"blue",children:[Object(c.jsx)(N.a,{name:"comments"}),"Comments"]}),Object(c.jsx)(A.a,{as:"a",basic:!0,color:"blue",pointing:"left",children:l})]})}),b&&b.username===o&&Object(c.jsx)(J,{postId:a})]})]})},V=n(180),W=n(258),K=n(133),X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(s.useState)(t),r=Object(j.a)(n,2),a=r[0],o=r[1],c=function(e){return o(Object(b.a)(Object(b.a)({},a),{},Object(K.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:c,onSubmit:i,values:a}};function Y(){var e=Object(q.a)(["\n    mutation createPost($body: String!){\n        createPost(body: $body){\n            id body createdAt username\n            likes {\n                id username createdAt\n            }\n            likeCount\n            comments {\n                id body username createdAt\n            }\n            commentCount\n        }\n    }\n"]);return Y=function(){return e},e}function Z(){var e=X((function(){s()}),{body:""}),t=e.values,n=e.onChange,r=e.onSubmit,a=Object(I.useMutation)(_,{variables:t,update:function(e,n){var r=e.readQuery({query:F}),a=Object(V.a)(r.getPosts);a=[n.data.createPost].concat(Object(V.a)(a)),e.writeQuery({query:F,data:Object(b.a)(Object(b.a)({},r),{},{getPosts:{newData:a}})}),t.body=""},onError:function(e){console.log(e)}}),o=Object(j.a)(a,2),s=o[0],i=o[1].error;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)(W.a,{onSubmit:r,children:[Object(c.jsx)("h2",{children:"Create a post:"}),Object(c.jsxs)(W.a.Field,{children:[Object(c.jsx)(W.a.Input,{placeholder:"Ho Worodl",name:"body",onChange:n,value:t.body,error:!!i}),Object(c.jsx)($.a,{type:"submit",color:"teal",children:"Submit"})]})]}),i&&Object(c.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(c.jsx)("ul",{className:"list",children:Object(c.jsx)("li",{children:i.graphQLErrors[0].message})})})]})}var _=Object(I.gql)(Y());var ee=function(){var e=Object(s.useContext)(p).user,t=Object(I.useQuery)(F),n=t.loading,r=t.data,a=Object(s.useState)([]),o=Object(j.a)(a,2),i=o[0],u=o[1];return Object(s.useEffect)((function(){r&&u(r.getPosts)}),[r]),Object(c.jsxs)(C.a,{columns:3,children:[Object(c.jsx)(C.a.Row,{className:"page-title",children:Object(c.jsx)("h1",{children:"Recent posts"})}),Object(c.jsxs)(C.a.Row,{children:[e&&Object(c.jsx)(C.a.Column,{children:Object(c.jsx)(Z,{})}),n?Object(c.jsx)("h1",{children:"Loading posts..."}):Object(c.jsx)(w.a.Group,{children:i&&i.map((function(e){return Object(c.jsx)(C.a.Column,{style:{marginBottom:20},children:Object(c.jsx)(U,{post:e})},e.id)}))})]})]})};function te(){var e=Object(q.a)(["\n    mutation register(\n        $username: String!\n        $email: String!\n        $password: String!\n        $confirmPassword: String!\n    ) {\n        register(\n            registerInput: {\n                username: $username\n                email: $email\n                password: $password\n                confirmPassword: $confirmPassword\n            }\n        ){\n            id email username createdAt token\n        }\n    }\n"]);return te=function(){return e},e}var ne=Object(I.gql)(te()),re=function(e){var t=Object(s.useContext)(p),n=Object(s.useState)({}),r=Object(j.a)(n,2),a=r[0],o=r[1],i=X((function(){O()}),{username:"",email:"",password:"",confirmPassword:""}),u=i.onChange,l=i.onSubmit,b=i.values,d=Object(I.useMutation)(ne,{update:function(n,r){var a=r.data.register;t.login(a),e.history.push("/")},onError:function(e){o(e.graphQLErrors[0].extensions.exception.errors)},variables:b}),m=Object(j.a)(d,2),O=m[0],h=m[1].loading;return Object(c.jsxs)("div",{className:"form-container",children:[Object(c.jsxs)(W.a,{onSubmit:l,noValidate:!0,className:h?"loading":"",children:[Object(c.jsx)("h1",{children:"Register"}),Object(c.jsx)(W.a.Input,{label:"Login",placeholder:"write your username",name:"username",type:"text",value:b.username,error:!!a.username,onChange:u}),Object(c.jsx)(W.a.Input,{label:"Email",placeholder:"write your email",name:"email",type:"email",value:b.email,error:!!a.email,onChange:u}),Object(c.jsx)(W.a.Input,{label:"Password",placeholder:"write your password",name:"password",type:"password",value:b.password,error:!!a.password,onChange:u}),Object(c.jsx)(W.a.Input,{label:"Confrim password",placeholder:"confirm your password",name:"confirmPassword",type:"password",value:b.confirmPassword,error:!!a.confirmPassword,onChange:u}),Object(c.jsx)("button",{className:"form-button",type:"submit",placeholder:"Register",children:"Register"})]}),Object.keys(a).length>0&&Object(c.jsx)("div",{className:"ui error message",children:Object(c.jsx)("ul",{className:"list",children:Object.values(a).map((function(e){return Object(c.jsx)("li",{children:e},e)}))})})]})};function ae(){var e=Object(q.a)(["\n    mutation login(\n        $username: String!\n        $password: String!\n    ) {\n        login(\n                username: $username\n                password: $password\n        ){\n            id email username createdAt token\n        }\n    }\n"]);return ae=function(){return e},e}var oe=Object(I.gql)(ae()),ce=function(e){var t=Object(s.useContext)(p),n=Object(s.useState)({}),r=Object(j.a)(n,2),a=r[0],o=r[1],i=X((function(){O()}),{username:"",password:""}),u=i.onChange,l=i.onSubmit,b=i.values,d=Object(I.useMutation)(oe,{update:function(n,r){var a=r.data.login;t.login(a),e.history.push("/")},onError:function(e){o(e.graphQLErrors[0].extensions.exception.errors)},variables:b}),m=Object(j.a)(d,2),O=m[0],h=m[1].loading;return Object(c.jsxs)("div",{className:"form-container",children:[Object(c.jsxs)(W.a,{onSubmit:l,noValidate:!0,className:h?"loading":"",children:[Object(c.jsx)("h1",{children:"Login"}),Object(c.jsx)(W.a.Input,{label:"Login",placeholder:"write your username",name:"username",type:"text",value:b.username,error:!!a.username,onChange:u}),Object(c.jsx)(W.a.Input,{label:"Password",placeholder:"write your password",name:"password",type:"password",value:b.password,error:!!a.password,onChange:u}),Object(c.jsx)("button",{class:"form-button",type:"submit",placeholder:"Register",children:"Login"})]}),Object.keys(a).length>0&&Object(c.jsx)("div",{className:"ui error message",children:Object(c.jsx)("ul",{className:"list",children:Object.values(a).map((function(e){return Object(c.jsx)("li",{children:e},e)}))})})]})},se=n(208);function ie(){var e=Object(q.a)(["\n    query($postId: ID!){\n        getPost(postId: $postId){\n            id \n            body \n            createdAt \n            username \n            likeCount\n            likes{\n                username\n            }\n            commentCount\n            comments{\n                id username createdAt body\n            }\n        }\n    }\n"]);return ie=function(){return e},e}function ue(){var e=Object(q.a)(["\n    mutation($postId: String!, $body: String!){\n        createComment(postId: $postId, body: $body){\n            id\n            comments{\n                id body createdAt username\n            }\n            commentCount\n        }\n    }\n"]);return ue=function(){return e},e}var le=Object(I.gql)(ue()),je=Object(I.gql)(ie()),be=function(e){var t,n=e.match.params.postId,r=Object(s.useContext)(p).user,a=Object(s.useRef)(null),o=Object(s.useState)(""),i=Object(j.a)(o,2),u=i[0],l=i[1],b=Object(I.useQuery)(je,{variables:{postId:n}}).data,d=(b=void 0===b?{}:b).getPost,m=Object(I.useMutation)(le,{update:function(){l(""),a.current.blur()},variables:{postId:n,body:u}}),O=Object(j.a)(m,1)[0];if(d){var h=d.id,x=d.body,g=d.createdAt,f=d.username,v=d.comments,y=d.likes,w=d.likeCount,P=d.commentCount;t=Object(c.jsx)(C.a,{children:Object(c.jsxs)(C.a.Row,{children:[Object(c.jsx)(se.a,{width:2,children:Object(c.jsx)(S.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",floated:"right"})}),Object(c.jsxs)(se.a,{width:10,children:[Object(c.jsxs)(k.a,{fluid:!0,children:[Object(c.jsxs)(k.a.Content,{children:[Object(c.jsx)(k.a.Header,{children:f}),Object(c.jsx)(k.a.Meta,{children:D()(g).fromNow()}),Object(c.jsx)(k.a.Description,{children:x})]}),Object(c.jsx)("hr",{}),Object(c.jsxs)(k.a.Content,{extra:!0,children:[Object(c.jsx)(R,{user:r,post:{id:h,likeCount:w,likes:y}}),Object(c.jsxs)($.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("Comment on post")},children:[Object(c.jsx)($.a,{basic:!0,color:"blue",children:Object(c.jsx)(N.a,{name:"comments"})}),Object(c.jsx)(A.a,{basic:!0,color:"blue",pointing:"left",children:P})]}),r&&r.username===f&&Object(c.jsx)(J,{postId:h,callback:function(){e.history.push("/")}})]})]}),r&&Object(c.jsxs)(k.a,{fluid:!0,children:[Object(c.jsx)("p",{children:"Post a comment"}),Object(c.jsx)(W.a,{children:Object(c.jsxs)("div",{className:"ui action input fluid",children:[Object(c.jsx)("input",{type:"text",placeholder:"Comment..",name:u,onChange:function(e){return l(e.target.value)},ref:a}),Object(c.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===u.trim(),onClick:O,children:"Submit"})]})})]}),v.map((function(e){return Object(c.jsx)(k.a,{fluid:!0,children:Object(c.jsxs)(k.a.Content,{children:[r&&r.username===e.username&&Object(c.jsx)(J,{postId:h,commentId:e.id}),Object(c.jsx)(k.a.Header,{children:e.username}),Object(c.jsx)(k.a.Meta,{children:D()(e.createdAt).fromNow()}),Object(c.jsx)(k.a.Description,{children:e.body})]})},e.id)}))]})]})})}else t=Object(c.jsx)("p",{children:"Loading..."});return t};var de=function(){return Object(c.jsx)(x,{children:Object(c.jsx)(i.a,{children:Object(c.jsxs)(l.a,{children:[Object(c.jsx)(y,{}),Object(c.jsx)(u.b,{exact:!0,path:"/",component:ee}),Object(c.jsx)(f,{exact:!0,path:"/login",component:ce}),Object(c.jsx)(f,{exact:!0,path:"/register",component:re}),Object(c.jsx)(u.b,{exact:!0,path:"/posts/:postId",component:be})]})})})},me=n(210),Oe=Object(I.createHttpLink)({uri:"https://nameless-beyond-69969.herokuapp.com"}),pe=Object(me.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),he=new I.ApolloClient({link:pe.concat(Oe),cache:new I.InMemoryCache}),xe=Object(c.jsx)(I.ApolloProvider,{client:he,children:Object(c.jsx)(de,{})});n(238);a.a.render(xe,document.getElementById("root")),o()}},[[239,1,2]]]);
//# sourceMappingURL=main.7b3afcbe.chunk.js.map